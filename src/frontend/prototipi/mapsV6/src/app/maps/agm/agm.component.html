<div *ngIf="!map_loaded" class="mx-auto my-5">
    <img src="../../../assets/img/map_loading_resized.gif">
</div>
<agm-map [latitude]="centroMappa.coordinate.latitudine" [longitude]="centroMappa.coordinate.longitudine"
         [zoom]="centroMappa.zoom" (mapReady)="mappaCaricata()" (centerChange)="centroCambiato($event)"
         [usePanning]="true">
    <agm-marker-cluster
            imagePath="https://raw.githubusercontent.com/googlemaps/v3-utility-library/master/markerclustererplus/images/m"
            [minimumClusterSize]="minMarkerCluster">
        <agm-marker *ngFor="let richiestaMarker of richiesteMarkers;" [latitude]="richiestaMarker.getCoordinate().latitudine"
                    [longitude]="richiestaMarker.getCoordinate().longitudine"
                    (markerClick)="selezioneMarker(richiestaMarker)"
                    [iconUrl]="urlIcona(richiestaMarker)" [animation]="tipoAnimazione(richiestaMarker)" [visible]="true">
            <agm-info-window *ngIf="trueMarker(richiestaMarker)">
                <strong>{{richiestaMarker.label}}</strong>
                <div *ngIf="datiMeteo" class="h-infowindow">
                    <hr class="my-0">
                    <div>
                        <img class="mr-2 iconameteo w-25" src="http://openweathermap.org/img/w/{{datiMeteo.icona}}.png">
                        <span class="text-capitalize">{{datiMeteo.descrizione}}</span>
                    </div>
                    <div class="text-center">{{datiMeteo.temperatura}}°C - Umidità: {{datiMeteo.umidita}}%</div>
                    <div class="text-center">Vento {{datiMeteo.vento}} km/h
                        <i [ngStyle]="{'transform': 'rotate('+datiMeteo.direzione.gradi+'deg)', '-webkit-transform': 'rotate('+datiMeteo.direzione.gradi+'deg)', '-ms-transform': 'rotate('+datiMeteo.direzione.gradi+'deg)'}"
                           class="pl-2 fa fa-long-arrow-up"></i> {{datiMeteo.direzione.cardinali}}
                    </div>
                </div>
            </agm-info-window>
        </agm-marker>
    </agm-marker-cluster>
    <agm-marker-cluster
            imagePath="https://raw.githubusercontent.com/googlemaps/v3-utility-library/master/markerclustererplus/images/m"
            [minimumClusterSize]="minMarkerCluster">
        <agm-marker *ngFor="let sedeMarker of sediMarkers;" [latitude]="sedeMarker.getCoordinate().latitudine"
                    [longitude]="sedeMarker.getCoordinate().longitudine"
                    (markerClick)="selezioneMarker(sedeMarker)"
                    [iconUrl]="urlIcona(sedeMarker)" [animation]="tipoAnimazione(sedeMarker)" [visible]="true">
            <agm-info-window *ngIf="trueMarker(sedeMarker)">
                <strong>{{sedeMarker.descrizione}}</strong>
                <div *ngIf="datiMeteo" class="h-infowindow">
                    <hr class="my-0">
                    <div>
                        <img class="mr-2 iconameteo w-25" src="http://openweathermap.org/img/w/{{datiMeteo.icona}}.png">
                        <span class="text-capitalize">{{datiMeteo.descrizione}}</span>
                    </div>
                    <div class="text-center">{{datiMeteo.temperatura}}°C - Umidità: {{datiMeteo.umidita}}%</div>
                    <div class="text-center">Vento {{datiMeteo.vento}} km/h
                        <i [ngStyle]="{'transform': 'rotate('+datiMeteo.direzione.gradi+'deg)', '-webkit-transform': 'rotate('+datiMeteo.direzione.gradi+'deg)', '-ms-transform': 'rotate('+datiMeteo.direzione.gradi+'deg)'}"
                           class="pl-2 fa fa-long-arrow-up"></i> {{datiMeteo.direzione.cardinali}}
                    </div>
                </div>
            </agm-info-window>
        </agm-marker>
    </agm-marker-cluster>
    <agm-marker-cluster
            imagePath="https://raw.githubusercontent.com/googlemaps/v3-utility-library/master/markerclustererplus/images/m"
            [minimumClusterSize]="minMarkerCluster">
        <agm-marker *ngFor="let mezzoMarker of mezziMarkers;" [latitude]="mezzoMarker.getCoordinate().latitudine"
                    [longitude]="mezzoMarker.getCoordinate().longitudine"
                    (markerClick)="selezioneMarker(mezzoMarker)"
                    [iconUrl]="urlIcona(mezzoMarker)" [animation]="tipoAnimazione(mezzoMarker)" [visible]="true">
            <agm-info-window *ngIf="trueMarker(mezzoMarker)">
                <strong>{{mezzoMarker.label}}</strong>
                <div *ngIf="datiMeteo" class="h-infowindow">
                    <hr class="my-0">
                    <div>
                        <img class="mr-2 iconameteo w-25" src="http://openweathermap.org/img/w/{{datiMeteo.icona}}.png">
                        <span class="text-capitalize">{{datiMeteo.descrizione}}</span>
                    </div>
                    <div class="text-center">{{datiMeteo.temperatura}}°C - Umidità: {{datiMeteo.umidita}}%</div>
                    <div class="text-center">Vento {{datiMeteo.vento}} km/h
                        <i [ngStyle]="{'transform': 'rotate('+datiMeteo.direzione.gradi+'deg)', '-webkit-transform': 'rotate('+datiMeteo.direzione.gradi+'deg)', '-ms-transform': 'rotate('+datiMeteo.direzione.gradi+'deg)'}"
                           class="pl-2 fa fa-long-arrow-up"></i> {{datiMeteo.direzione.cardinali}}
                    </div>
                </div>
            </agm-info-window>
        </agm-marker>
    </agm-marker-cluster>
    <app-agm-content (onMapLoad)='loadAPIWrapper($event)'></app-agm-content>
</agm-map>